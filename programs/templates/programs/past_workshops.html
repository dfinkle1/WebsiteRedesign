{% extends "base.html" %}
{% load static %}
{% block title %}
    Past Workshops - AIM
{% endblock title %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/pages/workshops.css' %}">
{% endblock extra_css %}
{% block content %}
    <div class="container py-5">
        <div class="row mb-4">
            <div class="col">
                <h1 class="display-4">Past Workshops</h1>
                <p class="lead text-muted">Browse our archive of completed workshops</p>
            </div>
        </div>
        <!-- Filter Section -->
        <div class="filter-section">
            <form method="get"
                  action="{% url 'programs:past-workshops' %}"
                  class="row g-3">
                <div class="col-md-4">
                    <label for="year" class="form-label">Filter by Year</label>
                    <select name="year" id="year" class="form-select">
                        <option value="">All Years</option>
                        {% for year in available_years %}
                            <option value="{{ year }}"
                                    {% if selected_year == year|stringformat:"s" %}selected{% endif %}>
                                {{ year }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="search" class="form-label">Search</label>
                    <input type="text"
                           name="search"
                           id="search"
                           class="form-control"
                           placeholder="Search by title, organizer, or code..."
                           value="{{ search_query }}">
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Filter</button>
                </div>
            </form>
            {% if selected_year or search_query %}
                <div class="mt-3">
                    <a href="{% url 'programs:past-workshops' %}"
                       class="btn btn-sm btn-outline-secondary">Clear Filters</a>
                </div>
            {% endif %}
        </div>
        <!-- Results -->
        {% if workshops %}
            <div class="row">
                {% for workshop in workshops %}
                    <div class="col-md-6 mb-4">
                        <div class="card workshop-card h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h5 class="card-title mb-0">
                                        <a href="{% url 'programs:program-page' workshop.code %}"
                                           class="text-decoration-none">{{ workshop.title }}</a>
                                    </h5>
                                </div>
                                {% if workshop.start_date or workshop.end_date %}
                                    <p class="workshop-date mb-2">
                                        {% if workshop.start_date and workshop.end_date %}
                                            {{ workshop.start_date|date:"M d, Y" }} - {{ workshop.end_date|date:"M d, Y" }}
                                        {% elif workshop.start_date %}
                                            Started: {{ workshop.start_date|date:"M d, Y" }}
                                        {% elif workshop.end_date %}
                                            Ended: {{ workshop.end_date|date:"M d, Y" }}
                                        {% endif %}
                                    </p>
                                {% endif %}
                                {% if workshop.organizer1 %}
                                    <p class="card-text mb-2">
                                        <strong>Organizer:</strong> {{ workshop.organizer1 }}
                                        {% if workshop.organizer2 %}, {{ workshop.organizer2 }}{% endif %}
                                    </p>
                                {% endif %}
                                {% if workshop.location %}
                                    <p class="card-text mb-2">
                                        <strong>Location:</strong> {{ workshop.location }}
                                    </p>
                                {% endif %}
                                {% if workshop.description %}
                                    <p class="card-text text-muted">{{ workshop.description|truncatewords:30 }}</p>
                                {% endif %}
                                <a href="{% url 'programs:program-page' workshop.code %}"
                                   class="btn btn-sm btn-outline-primary mt-2">View Details â†’</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <!-- Pagination -->
            {% if workshops.has_other_pages %}
                <nav aria-label="Workshop pagination" class="mt-4">
                    <ul class="pagination justify-content-center">
                        <!-- Previous button -->
                        {% if workshops.has_previous %}
                            <li class="page-item">
                                <a class="page-link"
                                   href="?page={{ workshops.previous_page_number }}{% if selected_year %}&year={{ selected_year }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}"
                                   aria-label="Previous">
                                    <span aria-hidden="true">&laquo; Previous</span>
                                </a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">&laquo; Previous</span>
                            </li>
                        {% endif %}
                        <!-- Page numbers -->
                        {% for num in workshops.paginator.page_range %}
                            {% if workshops.number == num %}
                                <li class="page-item active" aria-current="page">
                                    <span class="page-link">{{ num }}</span>
                                </li>
                            {% elif num > workshops.number|add:'-3' and num < workshops.number|add:'3' %}
                                <li class="page-item">
                                    <a class="page-link"
                                       href="?page={{ num }}{% if selected_year %}&year={{ selected_year }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">
                                        {{ num }}
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %}
                        <!-- Next button -->
                        {% if workshops.has_next %}
                            <li class="page-item">
                                <a class="page-link"
                                   href="?page={{ workshops.next_page_number }}{% if selected_year %}&year={{ selected_year }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}"
                                   aria-label="Next">
                                    <span aria-hidden="true">Next &raquo;</span>
                                </a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">Next &raquo;</span>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
                <!-- Pagination info -->
                <p class="text-center text-muted small">
                    Showing {{ workshops.start_index }}-{{ workshops.end_index }} of {{ workshops.paginator.count }} workshop{{ workshops.paginator.count|pluralize }}
                </p>
            {% endif %}
        {% else %}
            <div class="alert alert-info" role="alert">
                <h5 class="alert-heading">No workshops found</h5>
                <p class="mb-0">
                    {% if selected_year or search_query %}
                        No workshops match your filters. Try adjusting your search or year filter.
                    {% else %}
                        There are no past workshops to display at this time.
                    {% endif %}
                </p>
            </div>
        {% endif %}
        <!-- Info box -->
        <div class="mt-4 p-3 bg-light rounded">
            <p class="mb-0 text-muted small">
                <strong>Note:</strong> Showing 10 workshops per page.
                Use the filters above to narrow your search by year or keywords.
            </p>
        </div>
    </div>
{% endblock content %}

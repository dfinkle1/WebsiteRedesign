{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
{{ block.super }}
<style>
    .email-box {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 20px;
        margin-bottom: 20px;
    }
    .email-textarea {
        width: 100%;
        min-height: 150px;
        padding: 10px;
        font-family: monospace;
        font-size: 13px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-bottom: 10px;
    }
    .copy-button {
        background: #417690;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
    }
    .copy-button:hover {
        background: #2d5468;
    }
    .copy-button.success {
        background: #28a745;
    }
    .email-list {
        margin-top: 20px;
    }
    .email-list ul {
        list-style: none;
        padding: 0;
    }
    .email-list li {
        padding: 5px 10px;
        border-bottom: 1px solid #eee;
        font-family: monospace;
    }
    .email-list li:hover {
        background: #f5f5f5;
    }
</style>
{% endblock %}

{% block content %}
<h1>{{ program.title }} - Email List</h1>

<div class="email-box">
    <h2>Comma-Separated Email List ({{ count }} recipient{{ count|pluralize }})</h2>
    <p style="color: #666; margin-bottom: 15px;">
        This list includes all accepted applicants with email addresses. Copy and paste into your email client's BCC field.
    </p>

    <textarea id="emailTextarea" class="email-textarea" readonly>{{ emails_str }}</textarea>

    <button id="copyButton" class="copy-button">üìã Copy to Clipboard</button>
    <span id="copyStatus" style="margin-left: 10px; color: green; display: none;">‚úì Copied!</span>
</div>

{% if emails %}
<div class="email-list">
    <h2>Individual Email Addresses</h2>
    <ul>
        {% for email in emails %}
        <li>{{ email }}</li>
        {% endfor %}
    </ul>
</div>
{% else %}
<div class="email-box" style="text-align: center; color: #999;">
    No accepted applicants with email addresses found.
</div>
{% endif %}

<div class="submit-row" style="margin-top: 20px;">
    <a href="{% url 'admin:programs_program_applicants' program.id %}" class="button default">‚Üê Back to Applicants</a>
    <a href="{% url 'admin:programs_program_change' program.id %}" class="button">‚Üê Back to Program</a>
</div>

<script>
document.getElementById('copyButton').addEventListener('click', function() {
    const textarea = document.getElementById('emailTextarea');
    const button = document.getElementById('copyButton');
    const status = document.getElementById('copyStatus');

    // Select and copy text
    textarea.select();
    textarea.setSelectionRange(0, 99999); // For mobile devices

    try {
        document.execCommand('copy');

        // Show success feedback
        button.classList.add('success');
        button.textContent = '‚úì Copied!';
        status.style.display = 'inline';

        // Reset after 2 seconds
        setTimeout(function() {
            button.classList.remove('success');
            button.textContent = 'üìã Copy to Clipboard';
            status.style.display = 'none';
        }, 2000);
    } catch (err) {
        alert('Failed to copy. Please select and copy manually.');
    }

    // Deselect
    window.getSelection().removeAllRanges();
});
</script>
{% endblock %}

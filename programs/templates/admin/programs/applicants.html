{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
{{ block.super }}
<style>
    .stats-box {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
        margin-bottom: 20px;
    }
    .stats-box table {
        width: 100%;
        max-width: 400px;
    }
    .stats-box td {
        padding: 5px 10px;
    }
    .stats-box strong {
        font-weight: 600;
    }
    #result_list {
        width: 100%;
    }
    #result_list th {
        background: #417690;
        color: white;
        padding: 10px;
        text-align: left;
    }
    #result_list td {
        padding: 8px 10px;
        border-bottom: 1px solid #eee;
    }
    #result_list tr:hover {
        background: #f5f5f5;
    }
</style>
{% endblock %}

{% block content %}
<h1>{{ program.title }} - Applicants</h1>

<div class="stats-box">
    <h2>Statistics</h2>
    <table>
        <tr>
            <td><strong>Total:</strong></td>
            <td>{{ stats.total }}</td>
        </tr>
        <tr>
            <td><strong>Accepted:</strong></td>
            <td style="color: green;">{{ stats.accepted }}</td>
        </tr>
        <tr>
            <td><strong>Declined:</strong></td>
            <td style="color: red;">{{ stats.declined }}</td>
        </tr>
        <tr>
            <td><strong>Pending:</strong></td>
            <td style="color: orange;">{{ stats.pending }}</td>
        </tr>
    </table>
</div>

<div class="module">
    <h2>Applicants ({{ enrollments.count }})</h2>
    <table id="result_list">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>ORCID</th>
                <th>Institution</th>
                <th>Status</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for enrollment in enrollments %}
            <tr>
                <td>
                    {% if enrollment.person %}
                        {{ enrollment.person.first_name }} {{ enrollment.person.last_name }}
                    {% else %}
                        {{ enrollment.first_name }} {{ enrollment.last_name }}
                        <span style="color: #999; font-size: 0.85em;">(not linked)</span>
                    {% endif %}
                </td>
                <td>
                    {% if enrollment.person %}
                        {{ enrollment.person.email_address|default:"‚Äî" }}
                    {% else %}
                        {{ enrollment.email_snap|default:"‚Äî" }}
                    {% endif %}
                </td>
                <td>
                    {% if enrollment.person and enrollment.person.orcid_id %}
                    <a href="https://orcid.org/{{ enrollment.person.orcid_id }}" target="_blank">
                        {{ enrollment.person.orcid_id }}
                    </a>
                    {% elif enrollment.orcid_snap %}
                    <a href="https://orcid.org/{{ enrollment.orcid_snap }}" target="_blank">
                        {{ enrollment.orcid_snap }}
                    </a>
                    {% else %}‚Äî{% endif %}
                </td>
                <td>
                    {% if enrollment.person %}
                        {{ enrollment.person.institution|default:"‚Äî" }}
                    {% else %}
                        {{ enrollment.institution|default:"‚Äî" }}
                    {% endif %}
                </td>
                <td>
                    {% if enrollment.accepted_at %}
                    <span style="color: green;">‚úì Accepted</span>
                    {% elif enrollment.declined_at %}
                    <span style="color: red;">‚úó Declined</span>
                    {% else %}
                    <span style="color: gray;">‚Äî Pending</span>
                    {% endif %}
                </td>
                <td>
                    {% if enrollment.accepted_at %}
                    {{ enrollment.accepted_at|date:"Y-m-d H:i" }}
                    {% elif enrollment.declined_at %}
                    {{ enrollment.declined_at|date:"Y-m-d H:i" }}
                    {% else %}‚Äî{% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" style="text-align: center; padding: 20px; color: #999;">
                    No applicants yet
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="submit-row" style="margin-top: 20px;">
    <a href="{% url 'admin:programs_program_export_csv' program.id %}" class="button">üì• Export CSV</a>
    <a href="{% url 'admin:programs_program_emails' program.id %}" class="button">üìß Get Emails</a>
    <a href="{% url 'admin:programs_program_send_reminder' program.id %}" class="button">üì¨ Send Reminder</a>
    <a href="{% url 'admin:programs_program_change' program.id %}" class="button default">‚Üê Back to Program</a>
</div>
{% endblock %}

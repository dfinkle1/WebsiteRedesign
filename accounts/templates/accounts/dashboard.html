{% extends "base.html" %}
{% load static %}
{% block title %}
    Dashboard - AIM
{% endblock title %}
{% block content %}
    <div class="container py-4">
        {% if error %}
            <!-- Error Message -->
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <h4 class="alert-heading">Profile Error</h4>
                <p>{{ error }}</p>
                <hr>
                <p class="mb-0">User: {{ user.username }} (ID: {{ user.id }})</p>
                {% if debug_info %}<p class="mb-0 small">{{ debug_info }}</p>{% endif %}
                <p class="mb-0 mt-2">
                    Please check the server console logs for more details. The OAuth signal should create your profile automatically on login.
                </p>
                <button type="button"
                        class="btn-close"
                        data-bs-dismiss="alert"
                        aria-label="Close"></button>
            </div>
        {% else %}
            <!-- Welcome Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="h2 mb-1">
                                Welcome back, {{ person.preferred_name|default:person.first_name|default:request.user.username }}
                            </h1>
                            <p class="text-muted mb-0">
                                {% if person.institution %}
                                    {{ person.institution }}
                                {% else %}
                                    Manage your programs and profile
                                {% endif %}
                            </p>
                        </div>
                        <div>
                            <a href="{% url 'accounts:profile' %}" class="btn btn-outline-primary">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     width="16"
                                     height="16"
                                     fill="currentColor"
                                     class="bi bi-pencil"
                                     viewBox="0 0 16 16"
                                     aria-hidden="true">
                                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325" />
                                </svg>
                                Edit Profile
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Quick Stats Cards -->
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             width="24"
                                             height="24"
                                             fill="currentColor"
                                             class="bi bi-calendar-event text-primary"
                                             viewBox="0 0 16 16"
                                             aria-hidden="true">
                                            <path d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z" />
                                            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h3 class="h4 mb-0">{{ upcoming_count|default:0 }}</h3>
                                    <p class="text-muted small mb-0">Upcoming Programs</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <div class="rounded-circle bg-success bg-opacity-10 p-3">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             width="24"
                                             height="24"
                                             fill="currentColor"
                                             class="bi bi-check-circle text-success"
                                             viewBox="0 0 16 16"
                                             aria-hidden="true">
                                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                                            <path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h3 class="h4 mb-0">{{ past_count|default:0 }}</h3>
                                    <p class="text-muted small mb-0">Completed Programs</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0">
                                    <div class="rounded-circle bg-info bg-opacity-10 p-3">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             width="24"
                                             height="24"
                                             fill="currentColor"
                                             class="bi bi-person-circle text-info"
                                             viewBox="0 0 16 16"
                                             aria-hidden="true">
                                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
                                            <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h3 class="h4 mb-0">{{ profile_completion }}%</h3>
                                    <p class="text-muted small mb-0">Profile Complete</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Upcoming Programs -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-body border-0 py-3">
                            <h2 class="h5 mb-0">Upcoming Programs</h2>
                        </div>
                        <div class="card-body p-0">
                            {% if upcoming_enrollments %}
                                <div class="list-group list-group-flush">
                                    {% for enrollment in upcoming_enrollments %}
                                        <div class="list-group-item list-group-item-action">
                                            <div class="d-flex w-100 justify-content-between align-items-center">
                                                <div class="flex-grow-1">
                                                    <h3 class="h6 mb-1">{{ enrollment.workshop.title }}</h3>
                                                    <p class="text-muted small mb-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                             width="14"
                                                             height="14"
                                                             fill="currentColor"
                                                             class="bi bi-calendar3"
                                                             viewBox="0 0 16 16"
                                                             aria-hidden="true">
                                                            <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2M1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857z" />
                                                            <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2" />
                                                        </svg>
                                                        {{ enrollment.workshop.start_date|date:"M j, Y" }} - {{ enrollment.workshop.end_date|date:"M j, Y" }}
                                                    </p>
                                                    {% if enrollment.workshop.location %}
                                                        <p class="text-muted small mb-0">
                                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                                 width="14"
                                                                 height="14"
                                                                 fill="currentColor"
                                                                 class="bi bi-geo-alt"
                                                                 viewBox="0 0 16 16"
                                                                 aria-hidden="true">
                                                                <path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A32 32 0 0 1 8 14.58a32 32 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10" />
                                                                <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                                                            </svg>
                                                            {{ enrollment.workshop.location }}
                                                        </p>
                                                    {% endif %}
                                                </div>
                                                <div class="d-flex gap-2">
                                                    <a href="{% url 'enrollments:enrollment_details' enrollment.id %}"
                                                       class="btn btn-sm btn-outline-secondary">Edit Details</a>
                                                    <a href="{% url 'programs:program-page' enrollment.workshop.code %}"
                                                       class="btn btn-sm btn-outline-primary">View Program</a>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center py-5">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         width="48"
                                         height="48"
                                         fill="currentColor"
                                         class="bi bi-calendar-x text-muted mb-3"
                                         viewBox="0 0 16 16"
                                         aria-hidden="true">
                                        <path d="M6.146 7.146a.5.5 0 0 1 .708 0L8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 0 1 0-.708" />
                                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z" />
                                    </svg>
                                    <h3 class="h6 text-muted">No upcoming programs</h3>
                                    <p class="text-muted small mb-3">Check back later for new opportunities</p>
                                    <a href="{% url 'index' %}" class="btn btn-primary">Browse Programs</a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- Pending Applications -->
            {% if pending_applications %}
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm border-start border-info border-4">
                            <div class="card-header bg-body border-0 py-3">
                                <h2 class="h5 mb-0">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         width="20"
                                         height="20"
                                         fill="currentColor"
                                         class="bi bi-hourglass-split text-info me-2"
                                         viewBox="0 0 16 16">
                                        <path d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.351z"/>
                                    </svg>
                                    Pending Applications
                                </h2>
                            </div>
                            <div class="card-body p-0">
                                <div class="list-group list-group-flush">
                                    {% for enrollment in pending_applications %}
                                        <div class="list-group-item">
                                            <div class="d-flex w-100 justify-content-between align-items-center">
                                                <div class="flex-grow-1">
                                                    <h3 class="h6 mb-1">{{ enrollment.workshop.title }}</h3>
                                                    <p class="text-muted small mb-1">
                                                        {{ enrollment.workshop.start_date|date:"M j, Y" }} - {{ enrollment.workshop.end_date|date:"M j, Y" }}
                                                    </p>
                                                    <p class="text-info small mb-0">
                                                        Applied {{ enrollment.created_at|date:"M j, Y" }} &middot; Awaiting decision
                                                    </p>
                                                </div>
                                                <div>
                                                    <a href="{% url 'enrollments:enrollment_details' enrollment.id %}"
                                                       class="btn btn-sm btn-outline-info">View Application</a>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
            <!-- Pending Invitations -->
            {% if pending_invitations %}
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm border-start border-warning border-4">
                            <div class="card-header bg-body border-0 py-3">
                                <h2 class="h5 mb-0">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         width="20"
                                         height="20"
                                         fill="currentColor"
                                         class="bi bi-envelope-paper text-warning me-2"
                                         viewBox="0 0 16 16">
                                        <path d="M4 0a2 2 0 0 0-2 2v1.133l-.941.502A2 2 0 0 0 0 5.4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V5.4a2 2 0 0 0-1.059-1.765L14 3.133V2a2 2 0 0 0-2-2zm10 2v.217l-7 3.723L1 2.217V2a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1m-1 1.217V4l-7 3.5L1 4v-.783l7 3.5z" />
                                    </svg>
                                    Pending Invitations
                                </h2>
                            </div>
                            <div class="card-body p-0">
                                <div class="list-group list-group-flush">
                                    {% for invitation in pending_invitations %}
                                        <div class="list-group-item list-group-item-action">
                                            <div class="d-flex w-100 justify-content-between align-items-center">
                                                <div class="flex-grow-1">
                                                    <h3 class="h6 mb-1">{{ invitation.program.title }}</h3>
                                                    <p class="text-muted small mb-1">
                                                        {{ invitation.program.start_date|date:"M j, Y" }} - {{ invitation.program.end_date|date:"M j, Y" }}
                                                    </p>
                                                    <p class="text-warning small mb-0">Respond by {{ invitation.program.application_deadline|date:"M j, Y" }}</p>
                                                </div>
                                                <div>
                                                    <a href="{% url 'enrollments:invitation_respond' invitation.token %}"
                                                       class="btn btn-sm btn-warning">Respond</a>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
            <!-- Open Programs -->
            {% if open_programs %}
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-body border-0 py-3">
                                <h2 class="h5 mb-0">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         width="20"
                                         height="20"
                                         fill="currentColor"
                                         class="bi bi-door-open text-success me-2"
                                         viewBox="0 0 16 16">
                                        <path d="M8.5 10c-.276 0-.5-.448-.5-1s.224-1 .5-1 .5.448.5 1-.224 1-.5 1" />
                                        <path d="M10.828.122A.5.5 0 0 1 11 .5V1h.5A1.5 1.5 0 0 1 13 2.5V15h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V1.5a.5.5 0 0 1 .43-.495l7-1a.5.5 0 0 1 .398.117M11.5 2H11v13h1V2.5a.5.5 0 0 0-.5-.5M4 1.934V15h6V1.077z" />
                                    </svg>
                                    Open for Applications
                                </h2>
                            </div>
                            <div class="card-body p-0">
                                <div class="list-group list-group-flush">
                                    {% for program in open_programs %}
                                        <div class="list-group-item list-group-item-action">
                                            <div class="d-flex w-100 justify-content-between align-items-center">
                                                <div class="flex-grow-1">
                                                    <h3 class="h6 mb-1">{{ program.title }}</h3>
                                                    <p class="text-muted small mb-1">{{ program.start_date|date:"M j, Y" }} - {{ program.end_date|date:"M j, Y" }}</p>
                                                    <p class="text-success small mb-0">Apply by {{ program.application_deadline|date:"M j, Y" }}</p>
                                                </div>
                                                <div>
                                                    <a href="{% url 'programs:program-page' program.code %}"
                                                       class="btn btn-sm btn-outline-success">Apply</a>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
            <!-- Reimbursements -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-body border-0 py-3 d-flex justify-content-between align-items-center">
                            <h2 class="h5 mb-0">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     width="20"
                                     height="20"
                                     fill="currentColor"
                                     class="bi bi-receipt text-primary me-2"
                                     viewBox="0 0 16 16">
                                    <path d="M1.92.506a.5.5 0 0 1 .434.14L3 1.293l.646-.647a.5.5 0 0 1 .708 0L5 1.293l.646-.647a.5.5 0 0 1 .708 0L7 1.293l.646-.647a.5.5 0 0 1 .708 0L9 1.293l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .801.13l.5 1A.5.5 0 0 1 15 2v12a.5.5 0 0 1-.053.224l-.5 1a.5.5 0 0 1-.8.13L13 14.707l-.646.647a.5.5 0 0 1-.708 0L11 14.707l-.646.647a.5.5 0 0 1-.708 0L9 14.707l-.646.647a.5.5 0 0 1-.708 0L7 14.707l-.646.647a.5.5 0 0 1-.708 0L5 14.707l-.646.647a.5.5 0 0 1-.708 0L3 14.707l-.646.647a.5.5 0 0 1-.801-.13l-.5-1A.5.5 0 0 1 1 14V2a.5.5 0 0 1 .053-.224l.5-1a.5.5 0 0 1 .367-.27m.217 1.338L2 2.118v11.764l.137.274.51-.51a.5.5 0 0 1 .707 0l.646.647.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.509.509.137-.274V2.118l-.137-.274-.51.51a.5.5 0 0 1-.707 0L12 1.707l-.646.647a.5.5 0 0 1-.708 0L10 1.707l-.646.647a.5.5 0 0 1-.708 0L8 1.707l-.646.647a.5.5 0 0 1-.708 0L6 1.707l-.646.647a.5.5 0 0 1-.708 0L4 1.707l-.646.647a.5.5 0 0 1-.708 0z" />
                                    <path d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5m8-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5" />
                                </svg>
                                Reimbursements
                            </h2>
                            <a href="{% url 'reimbursements:my_reimbursements' %}"
                               class="btn btn-sm btn-outline-primary">View All</a>
                        </div>
                        <div class="card-body p-0">
                            {% if reimbursements %}
                                <div class="list-group list-group-flush">
                                    {% for reimbursement in reimbursements %}
                                        <div class="list-group-item">
                                            <div class="d-flex w-100 justify-content-between align-items-center">
                                                <div class="flex-grow-1">
                                                    <h3 class="h6 mb-1">
                                                        {% if reimbursement.enrollment %}
                                                            {{ reimbursement.enrollment.workshop.title }}
                                                        {% else %}
                                                            Reimbursement #{{ reimbursement.id }}
                                                        {% endif %}
                                                    </h3>
                                                    <p class="text-muted small mb-0">
                                                        ${{ reimbursement.total_requested|default:"0.00" }} requested
                                                        &middot; Created {{ reimbursement.created_at|date:"M j, Y" }}
                                                    </p>
                                                </div>
                                                <div>
                                                    {% if reimbursement.status == 'draft' %}
                                                        <span class="badge bg-secondary">Draft</span>
                                                    {% elif reimbursement.status == 'submitted' %}
                                                        <span class="badge bg-info">Submitted</span>
                                                    {% elif reimbursement.status == 'changes_needed' %}
                                                        <span class="badge bg-warning text-dark">Changes Needed</span>
                                                    {% elif reimbursement.status == 'approved' %}
                                                        <span class="badge bg-success">Approved</span>
                                                    {% elif reimbursement.status == 'paid' %}
                                                        <span class="badge bg-success">Paid</span>
                                                    {% elif reimbursement.status == 'cancelled' %}
                                                        <span class="badge bg-danger">Cancelled</span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center py-4">
                                    <p class="text-muted small mb-2">No reimbursement requests yet</p>
                                    <a href="{% url 'reimbursements:create' %}"
                                       class="btn btn-sm btn-primary">New Reimbursement Request</a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- Past Programs -->
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-body border-0 py-3">
                            <h2 class="h5 mb-0">Past Programs</h2>
                        </div>
                        <div class="card-body p-0">
                            {% if past_enrollments %}
                                <div class="list-group list-group-flush">
                                    {% for enrollment in past_enrollments|slice:":5" %}
                                        <div class="list-group-item">
                                            <div class="d-flex w-100 justify-content-between align-items-center">
                                                <div class="flex-grow-1">
                                                    <h3 class="h6 mb-1">{{ enrollment.workshop.title }}</h3>
                                                    <p class="text-muted small mb-0">
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                             width="14"
                                                             height="14"
                                                             fill="currentColor"
                                                             class="bi bi-calendar-check"
                                                             viewBox="0 0 16 16"
                                                             aria-hidden="true">
                                                            <path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0" />
                                                            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z" />
                                                        </svg>
                                                        Completed {{ enrollment.workshop.end_date|date:"M j, Y" }}
                                                    </p>
                                                </div>
                                                <div>
                                                    <span class="badge bg-success">Completed</span>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                                {% if past_enrollments|length > 5 %}
                                    <div class="card-footer bg-body border-0 text-center py-3">
                                        <a href="#" class="text-decoration-none small">View all {{ past_enrollments|length }} programs</a>
                                    </div>
                                {% endif %}
                            {% else %}
                                <div class="text-center py-5">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         width="48"
                                         height="48"
                                         fill="currentColor"
                                         class="bi bi-inbox text-muted mb-3"
                                         viewBox="0 0 16 16"
                                         aria-hidden="true">
                                        <path d="M4.98 4a.5.5 0 0 0-.39.188L1.54 8H6a.5.5 0 0 1 .5.5 1.5 1.5 0 1 0 3 0A.5.5 0 0 1 10 8h4.46l-3.05-3.812A.5.5 0 0 0 11.02 4zm-1.17-.437A1.5 1.5 0 0 1 4.98 3h6.04a1.5 1.5 0 0 1 1.17.563l3.7 4.625a.5.5 0 0 1 .106.374l-.39 3.124A1.5 1.5 0 0 1 14.117 13H1.883a1.5 1.5 0 0 1-1.489-1.314l-.39-3.124a.5.5 0 0 1 .106-.374z" />
                                    </svg>
                                    <h3 class="h6 text-muted">No past programs yet</h3>
                                    <p class="text-muted small">Your completed programs will appear here</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock content %}

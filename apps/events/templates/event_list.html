{% extends "base.html" %}
{% load static %}
{% block title %}Events | AIM{% endblock title %}
{% block content %}
<div class="container py-5">
    <h1 class="mb-4">Events</h1>

    <!-- Upcoming Events -->
    <section class="mb-5">
        <h2 class="h4 mb-3">Upcoming Events</h2>
        {% if upcoming %}
        <div class="row g-4">
            {% for event in upcoming %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100">
                    {% if event.image %}
                    <img src="{{ event.image.url }}"
                         class="card-img-top"
                         alt="{{ event.title }}"
                         style="height: 180px; object-fit: cover;">
                    {% else %}
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center"
                         style="height: 180px;">
                        <span class="text-muted">{{ event.get_event_type_display }}</span>
                    </div>
                    {% endif %}
                    <div class="card-body d-flex flex-column">
                        <div class="mb-2">
                            <span class="badge bg-secondary">{{ event.get_event_type_display }}</span>
                            {% if event.is_online %}
                            <span class="badge bg-primary">Online</span>
                            {% endif %}
                            {% if event.is_free %}
                            <span class="badge bg-success">Free</span>
                            {% endif %}
                        </div>
                        <h5 class="card-title">
                            <a href="{{ event.get_absolute_url }}" class="text-decoration-none stretched-link">
                                {{ event.title }}
                            </a>
                        </h5>
                        <p class="card-text text-muted small mb-2">
                            <strong>{{ event.start|date:"l, M j" }}</strong> &middot; {{ event.start|date:"g:i A" }}
                        </p>
                        {% if event.city %}
                        <p class="card-text text-muted small mb-0">
                            {{ event.venue_name }}{% if event.venue_name and event.city %}, {% endif %}{{ event.city }}
                        </p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-muted">No upcoming events at this time. Check back soon!</p>
        {% endif %}
    </section>

    <!-- Past Events -->
    {% if past %}
    <section>
        <h2 class="h4 mb-3">Past Events</h2>

        <!-- Year navigation -->
        {% regroup past by year as past_by_year %}
        <nav class="mb-4">
            <ul class="nav nav-pills gap-2 flex-wrap">
                {% for g in past_by_year %}
                <li class="nav-item">
                    <a href="#year-{{ g.grouper }}" class="nav-link py-1 px-3">{{ g.grouper }}</a>
                </li>
                {% endfor %}
            </ul>
        </nav>

        <!-- Events grouped by year -->
        {% for g in past_by_year %}
        <div class="mb-4" id="year-{{ g.grouper }}">
            <h3 class="h5 border-bottom pb-2">{{ g.grouper }}</h3>
            <ul class="list-unstyled">
                {% for event in g.list %}
                <li class="py-2 border-bottom">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <a href="{{ event.get_absolute_url }}" class="text-decoration-none">
                                {{ event.title }}
                            </a>
                            <br>
                            <small class="text-muted">
                                {{ event.start|date:"M j" }}
                                {% if event.city %}&middot; {{ event.city }}{% endif %}
                            </small>
                        </div>
                        <span class="badge bg-light text-dark">{{ event.get_event_type_display }}</span>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
    </section>
    {% endif %}
</div>
{% endblock content %}
